---
import Main from "@/layouts/main.astro";
import SharedLoginForm from "@/components/shared/form.astro";
import Github from "@/icons/github.astro";
import LoginUtils from "@/lib/login";

const alert = { message: "" };

if (Astro.request.method === "POST") {
  const loginUtils = new LoginUtils(Astro.request, Astro.response);
  const [loginRequest, loginCookies] = await loginUtils.singUp();

  if (loginRequest.status !== 200) {
    alert.message = loginRequest.response
      ? loginUtils.createErrorMessage(loginRequest.response)
      : loginRequest.message;
  } else {
    loginUtils.redirectTo(loginCookies, "/profile");
  }
}
---

<Main title="Sign Up">
  <section class="max-w-[55ch] mx-auto p-8">
    <SharedLoginForm
      method="post"
      title="Sign Up"
      description="Enter username and password to sign up."
    >
      <a
        class="flex items-center border border-white hover:bg-white hover:text-black transition-colors p-2 rounded-lg justify-center font-medium"
        href="/api/github"
      >
        <Github class="mr-2" />
        SIGN UP WITH GITHUB
      </a>
    </SharedLoginForm>
  </section>
</Main>

<style>
  form {
    margin-block-start: 2rem;
  }
</style>
